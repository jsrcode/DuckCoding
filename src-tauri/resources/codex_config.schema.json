{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "description": "Codex CLI 的 config.toml 配置结构（翻译自官方文档），用于前端渲染与校验。",
  "type": "object",
  "additionalProperties": true,
  "$defs": {
    "featureFlags": {
      "type": "object",
      "description": "可选/实验特性的布尔开关表，对应 [features]。",
      "additionalProperties": false,
      "properties": {
        "unified_exec": {
          "type": "boolean",
          "description": "使用统一的 PTY exec 工具。"
        },
        "rmcp_client": {
          "type": "boolean",
          "description": "启用 RMCP（HTTP MCP + OAuth）功能。"
        },
        "apply_patch_freeform": {
          "type": "boolean",
          "description": "包含自由格式的 apply_patch 工具。"
        },
        "view_image_tool": {
          "type": "boolean",
          "description": "允许模型使用 view_image 工具。"
        },
        "web_search_request": {
          "type": "boolean",
          "description": "允许模型请求 Web 搜索。"
        },
        "exec_policy": {
          "type": "boolean",
          "description": "启用 exec 执行策略/风险评估（shell/unified exec 前置校验）。"
        },
        "experimental_sandbox_command_assessment": {
          "type": "boolean",
          "description": "启用模型对 sandbox 命令风险的评估。"
        },
        "enable_experimental_windows_sandbox": {
          "type": "boolean",
          "description": "启用 Windows 受限令牌 sandbox。"
        },
        "remote_compaction": {
          "type": "boolean",
          "description": "允许远程（服务端）对话压缩，用于 ChatGPT 登录场景。"
        },
        "shell_tool": {
          "type": "boolean",
          "description": "启用默认 shell 工具。"
        },
        "parallel": {
          "type": "boolean",
          "description": "允许模型并行调用多个工具（需模型支持）。"
        },
        "undo": {
          "type": "boolean",
          "description": "每轮创建可撤销的 ghost commit（undo）。"
        }
      }
    },
    "sandboxWorkspaceWrite": {
      "type": "object",
      "description": "workspace-write sandbox 的额外参数。",
      "additionalProperties": false,
      "properties": {
        "writable_roots": {
          "type": "array",
          "description": "额外可写根目录列表。",
          "items": {
            "type": "string"
          }
        },
        "network_access": {
          "type": "boolean",
          "description": "是否允许在 sandbox 中访问网络。"
        },
        "exclude_tmpdir_env_var": {
          "type": "boolean",
          "description": "排除 $TMPDIR，使其不再可写。"
        },
        "exclude_slash_tmp": {
          "type": "boolean",
          "description": "排除 /tmp，使其不再可写。"
        }
      }
    },
    "toolToggles": {
      "type": "object",
      "description": "工具开关（web_search/view_image 等）。",
      "additionalProperties": false,
      "properties": {
        "web_search": {
          "type": "boolean",
          "description": "允许 Codex 主动发起内置 Web 搜索。"
        },
        "web_search_request": {
          "type": "boolean",
          "description": "同 web_search，别名写法。"
        },
        "view_image": {
          "type": "boolean",
          "description": "允许发送截图/图片作为上下文。"
        }
      }
    },
    "shellEnvPolicy": {
      "type": "object",
      "description": "子进程环境变量继承/过滤策略。",
      "additionalProperties": false,
      "properties": {
        "inherit": {
          "type": "string",
          "enum": ["all", "core", "none"],
          "description": "环境基础模板：all=完整继承、core=仅核心变量、none=空环境。"
        },
        "ignore_default_excludes": {
          "type": "boolean",
          "description": "为 true 时跳过默认过滤（名称含 KEY/TOKEN 的变量）。"
        },
        "exclude": {
          "type": "array",
          "description": "需额外排除的变量通配符（不区分大小写）。",
          "items": {
            "type": "string"
          }
        },
        "include_only": {
          "type": "array",
          "description": "仅保留匹配这些模式的变量。",
          "items": {
            "type": "string"
          }
        },
        "set": {
          "type": "object",
          "description": "强制覆盖/新增的变量键值。",
          "additionalProperties": {
            "type": "string"
          }
        },
        "experimental_use_profile": {
          "type": "boolean",
          "description": "是否通过用户 shell profile 启动子进程（默认 false，实验选项）。"
        }
      }
    },
    "mcpServer": {
      "type": "object",
      "description": "单个 MCP 服务器的配置。",
      "additionalProperties": false,
      "properties": {
        "command": {
          "type": "string",
          "description": "STDIO 服务器启动命令。"
        },
        "args": {
          "type": "array",
          "description": "命令参数。",
          "items": {
            "type": "string"
          }
        },
        "cwd": {
          "type": "string",
          "description": "启动命令使用的工作目录。"
        },
        "env": {
          "type": "object",
          "description": "传递给服务器的额外环境变量。",
          "additionalProperties": {
            "type": "string"
          }
        },
        "env_vars": {
          "type": "array",
          "description": "允许透传的额外环境变量名。",
          "items": {
            "type": "string"
          }
        },
        "url": {
          "type": "string",
          "description": "streamable HTTP 服务器的 URL。"
        },
        "bearer_token_env_var": {
          "type": "string",
          "description": "携带 Bearer Token 的环境变量名。"
        },
        "http_headers": {
          "type": "object",
          "description": "固定 HTTP 头。",
          "additionalProperties": {
            "type": "string"
          }
        },
        "env_http_headers": {
          "type": "object",
          "description": "从环境变量注入的 HTTP 头，值应为环境变量名。",
          "additionalProperties": {
            "type": "string"
          }
        },
        "enabled": {
          "type": "boolean",
          "description": "是否启用该服务器。"
        },
        "startup_timeout_sec": {
          "type": "number",
          "description": "启动超时时间（秒）。"
        },
        "startup_timeout_ms": {
          "type": "integer",
          "description": "启动超时时间（毫秒，startup_timeout_sec 的别名）。"
        },
        "tool_timeout_sec": {
          "type": "number",
          "description": "单个工具调用超时（秒）。"
        },
        "enabled_tools": {
          "type": "array",
          "description": "仅允许的工具列表（白名单）。",
          "items": {
            "type": "string"
          }
        },
        "disabled_tools": {
          "type": "array",
          "description": "需要隐藏的工具列表（黑名单）。",
          "items": {
            "type": "string"
          }
        }
      }
    },
    "historySettings": {
      "type": "object",
      "description": "历史记录持久化配置，对应 [history] 表。",
      "additionalProperties": false,
      "properties": {
        "persistence": {
          "type": "string",
          "enum": ["save-all", "none"],
          "description": "历史保存策略：save-all 表示全部记录，none 表示禁用持久化。"
        },
        "max_bytes": {
          "type": "integer",
          "minimum": 0,
          "description": "历史文件允许的最大字节数（0/未设置使用内置默认；当前未强制执行）。"
        }
      }
    },
    "tuiSettings": {
      "type": "object",
      "description": "终端 UI 相关设置，对应 [tui] 表。",
      "additionalProperties": false,
      "properties": {
        "notifications": {
          "description": "桌面通知策略，可为布尔值或事件列表。",
          "anyOf": [
            {
              "type": "boolean"
            },
            {
              "type": "array",
              "items": {
                "type": "string"
              }
            }
          ]
        },
        "animations": {
          "type": "boolean",
          "description": "启用/禁用欢迎页、闪烁等 TUI 动画。"
        }
      }
    },
    "profileConfig": {
      "type": "object",
      "description": "profile 块允许覆盖的常见字段。",
      "additionalProperties": true,
      "properties": {
        "model": {
          "type": "string",
          "description": "该 profile 使用的模型名称。"
        },
        "model_provider": {
          "type": "string",
          "description": "该 profile 对应的模型提供方。",
          "x-key-source": "model_providers"
        },
        "model_reasoning_effort": {
          "type": "string",
          "enum": ["minimal", "low", "medium", "high"],
          "description": "Responses API 的 reasoning effort 级别。"
        },
        "model_reasoning_summary": {
          "type": "string",
          "enum": ["auto", "concise", "detailed", "none"],
          "description": "生成 reasoning summary 的粒度/开关。"
        },
        "model_verbosity": {
          "type": "string",
          "enum": ["low", "medium", "high"],
          "description": "Responses API 文本输出详略程度。"
        },
        "chatgpt_base_url": {
          "type": "string",
          "description": "ChatGPT 登录/请求使用的 base URL。"
        },
        "approval_policy": {
          "type": "string",
          "enum": ["untrusted", "on-failure", "on-request", "never"],
          "description": "该 profile 的审批策略。"
        },
        "sandbox_mode": {
          "type": "string",
          "enum": ["read-only", "workspace-write", "danger-full-access"],
          "description": "该 profile 的 sandbox 模式。"
        },
        "experimental_instructions_file": {
          "type": "string",
          "description": "基础指令文件（实验/兼容字段）。"
        },
        "experimental_compact_prompt_file": {
          "type": "string",
          "description": "历史压缩提示文件（实验/兼容字段）。"
        },
        "include_apply_patch_tool": {
          "type": "boolean",
          "description": "遗留开关：启用 apply_patch 工具。"
        },
        "experimental_use_unified_exec_tool": {
          "type": "boolean",
          "description": "遗留开关：启用统一 exec 工具。"
        },
        "experimental_use_rmcp_client": {
          "type": "boolean",
          "description": "遗留开关：启用实验 RMCP 客户端。"
        },
        "experimental_use_freeform_apply_patch": {
          "type": "boolean",
          "description": "遗留开关：启用自由格式 apply_patch。"
        },
        "experimental_sandbox_command_assessment": {
          "type": "boolean",
          "description": "遗留开关：模型评估 sandbox 命令风险。"
        },
        "tools_web_search": {
          "type": "boolean",
          "description": "遗留开关：允许 web_search 工具。"
        },
        "tools_view_image": {
          "type": "boolean",
          "description": "遗留开关：允许 view_image 工具。"
        },
        "features": {
          "$ref": "#/$defs/featureFlags"
        },
        "oss_provider": {
          "type": "string",
          "description": "本地 OSS 提供方（如 lmstudio、ollama）。"
        }
      }
    },
    "noticeSettings": {
      "type": "object",
      "description": "控制 CLI 提示/告警的可选开关。",
      "additionalProperties": false,
      "properties": {
        "hide_full_access_warning": {
          "type": "boolean",
          "description": "隐藏 danger-full-access 模式下的风险警告。"
        },
        "hide_world_writable_warning": {
          "type": "boolean",
          "description": "隐藏世界可写目录的风险提示。"
        },
        "hide_rate_limit_model_nudge": {
          "type": "boolean",
          "description": "隐藏速率限制模型切换提醒。"
        },
        "hide_gpt5_1_migration_prompt": {
          "type": "boolean",
          "description": "隐藏 GPT-5.1 迁移提示。"
        },
        "hide_gpt-5.1-codex-max_migration_prompt": {
          "type": "boolean",
          "description": "隐藏 gpt-5.1-codex-max 迁移提示。"
        }
      }
    },
    "projectEntry": {
      "type": "object",
      "description": "单个项目路径的信任级别设置。",
      "additionalProperties": false,
      "properties": {
        "trust_level": {
          "type": "string",
          "enum": ["trusted", "untrusted"],
          "description": "信任级别：trusted / untrusted。"
        }
      }
    },
    "otelConfig": {
      "type": "object",
      "description": "OpenTelemetry 日志与导出配置。",
      "additionalProperties": true,
      "properties": {
        "log_user_prompt": {
          "type": "boolean",
          "description": "是否在 OTEL 中包含用户提示内容。"
        },
        "environment": {
          "type": "string",
          "description": "OTEL environment 标签，例如 dev/staging。"
        },
        "exporter": {
          "description": "OTEL 导出方式，字符串形式或对象形式（otlp-http/otlp-grpc）。",
          "anyOf": [
            {
              "type": "string",
              "enum": ["none", "otlp-http", "otlp-grpc"]
            },
            {
              "type": "object",
              "additionalProperties": true,
              "properties": {
                "otlp-http": {
                  "type": "object",
                  "additionalProperties": true
                },
                "otlp-grpc": {
                  "type": "object",
                  "additionalProperties": true
                }
              }
            }
          ]
        }
      }
    }
  },
  "properties": {
    "model": {
      "type": "string",
      "description": "默认使用的模型名称（如 gpt-5、o3 等）。"
    },
    "review_model": {
      "type": "string",
      "description": "供 /review 功能使用的模型，不设置时沿用 model。"
    },
    "model_provider": {
      "type": "string",
      "description": "模型提供方 ID（来自 model_providers 表）。",
      "x-key-source": "model_providers"
    },
    "model_context_window": {
      "type": "integer",
      "minimum": 0,
      "description": "模型上下文窗口大小（token）。"
    },
    "model_auto_compact_token_limit": {
      "type": "integer",
      "minimum": 0,
      "description": "自动触发对话压缩的 token 阈值，0 表示禁用。"
    },
    "tool_output_token_limit": {
      "type": "integer",
      "minimum": 0,
      "description": "存储单次工具/函数输出的 token 上限。"
    },
    "model_reasoning_effort": {
      "type": "string",
      "enum": ["minimal", "low", "medium", "high"],
      "description": "Responses API 的 reasoning effort 级别。"
    },
    "model_reasoning_summary": {
      "type": "string",
      "enum": ["auto", "concise", "detailed", "none"],
      "description": "是否生成 reasoning summary 以及其粒度。"
    },
    "model_verbosity": {
      "type": "string",
      "enum": ["low", "medium", "high"],
      "description": "Responses API 中文本输出的详略程度。"
    },
    "hide_agent_reasoning": {
      "type": "boolean",
      "description": "隐藏 AgentReasoning 事件（减少中间思考输出）。"
    },
    "show_raw_agent_reasoning": {
      "type": "boolean",
      "description": "显示原始 reasoning 内容。"
    },
    "model_supports_reasoning_summaries": {
      "type": "boolean",
      "description": "强制认为当前模型支持 reasoning summaries。"
    },
    "model_reasoning_summary_format": {
      "type": "string",
      "enum": ["none", "experimental"],
      "description": "强制指定 reasoning summary 格式。"
    },
    "developer_instructions": {
      "type": "string",
      "description": "附加在 AGENTS.md 之后的开发者提示。"
    },
    "instructions": {
      "type": "string",
      "description": "兼容旧版的基础指令覆盖内容。"
    },
    "compact_prompt": {
      "type": "string",
      "description": "历史压缩提示词的内联覆盖。"
    },
    "experimental_instructions_file": {
      "type": "string",
      "description": "自定义基础指令文件路径。"
    },
    "experimental_compact_prompt_file": {
      "type": "string",
      "description": "自定义 compact prompt 文件路径。"
    },
    "approval_policy": {
      "type": "string",
      "enum": ["untrusted", "on-failure", "on-request", "never"],
      "description": "命令执行前需要审批的策略。"
    },
    "sandbox_mode": {
      "type": "string",
      "enum": ["read-only", "workspace-write", "danger-full-access"],
      "description": "命令执行所使用的 sandbox 模式。"
    },
    "sandbox_workspace_write": {
      "$ref": "#/$defs/sandboxWorkspaceWrite"
    },
    "features": {
      "$ref": "#/$defs/featureFlags"
    },
    "tools": {
      "$ref": "#/$defs/toolToggles"
    },
    "shell_environment_policy": {
      "$ref": "#/$defs/shellEnvPolicy"
    },
    "history": {
      "$ref": "#/$defs/historySettings"
    },
    "file_opener": {
      "type": "string",
      "enum": ["vscode", "vscode-insiders", "windsurf", "cursor", "none"],
      "description": "用于点击引用时打开文件的 URI scheme。"
    },
    "notice": {
      "$ref": "#/$defs/noticeSettings"
    },
    "cli_auth_credentials_store": {
      "type": "string",
      "enum": ["file", "keyring", "auto"],
      "description": "CLI 凭据存储位置。"
    },
    "chatgpt_base_url": {
      "type": "string",
      "description": "ChatGPT 登录流程使用的后端 base URL。"
    },
    "forced_chatgpt_workspace_id": {
      "type": "string",
      "description": "强制使用指定 ChatGPT workspace ID。"
    },
    "forced_login_method": {
      "type": "string",
      "enum": ["chatgpt", "api"],
      "description": "强制登录方式，覆盖自动判断。"
    },
    "project_doc_max_bytes": {
      "type": "integer",
      "minimum": 0,
      "description": "AGENTS.md 读取的最大字节数。"
    },
    "project_doc_fallback_filenames": {
      "type": "array",
      "description": "缺失 AGENTS.md 时的回退文件名列表。",
      "items": {
        "type": "string"
      }
    },
    "check_for_update_on_startup": {
      "type": "boolean",
      "description": "启动时检查 Codex 更新（默认 true，可在集中管理时关闭提示）。"
    },
    "disable_paste_burst": {
      "type": "boolean",
      "description": "禁用粘贴突发保护；输入不再缓冲/合并。"
    },
    "windows_wsl_setup_acknowledged": {
      "type": "boolean",
      "description": "标记 Windows/WSL 引导提示已确认。"
    },
    "experimental_use_unified_exec_tool": {
      "type": "boolean",
      "description": "旧版实验开关：启用统一 exec 工具。"
    },
    "experimental_use_rmcp_client": {
      "type": "boolean",
      "description": "旧版实验开关：启用 Rust MCP 客户端。"
    },
    "experimental_use_freeform_apply_patch": {
      "type": "boolean",
      "description": "旧版实验开关：启用自由格式 apply_patch。"
    },
    "experimental_sandbox_command_assessment": {
      "type": "boolean",
      "description": "旧版实验开关：模型评估 sandbox 风险。"
    },
    "mcp_servers": {
      "type": "object",
      "description": "MCP 服务器配置列表，键为自定义 server 名。",
      "additionalProperties": {
        "$ref": "#/$defs/mcpServer"
      }
    },
    "mcp_oauth_credentials_store": {
      "type": "string",
      "enum": ["auto", "file", "keyring"],
      "description": "MCP OAuth 凭据保存位置。"
    },
    "notify": {
      "type": "array",
      "description": "外部通知程序命令（argv 数组）；为空表示禁用。",
      "items": {
        "type": "string"
      }
    },
    "tui": {
      "$ref": "#/$defs/tuiSettings"
    },
    "profiles": {
      "type": "object",
      "description": "命名 profile 集合，可在 CLI 中通过 --profile 选择。",
      "additionalProperties": {
        "$ref": "#/$defs/profileConfig"
      }
    },
    "profile": {
      "type": "string",
      "description": "当前激活的 profile 名称。",
      "x-key-source": "profiles"
    },
    "model_providers": {
      "type": "object",
      "description": "自定义或覆盖模型提供方的配置表。",
      "additionalProperties": {
        "type": "object",
        "additionalProperties": true
      }
    },
    "oss_provider": {
      "type": "string",
      "description": "首选本地模型提供方（如 lmstudio、ollama）。"
    },
    "projects": {
      "type": "object",
      "description": "项目路径与信任级别映射。",
      "additionalProperties": {
        "$ref": "#/$defs/projectEntry"
      }
    },
    "otel": {
      "$ref": "#/$defs/otelConfig"
    }
  }
}
